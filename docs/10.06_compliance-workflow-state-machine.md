# Compliance Workflow State Machine (CW-SM-01)

Version: v1.0  
Status: **LOCKED**  
Owner: Marketplace Operator (RedRooEnergy)  
Applies to: Product compliance submission and certification workflows

---

## 1. Purpose
This document defines the authoritative compliance workflow state machine for
products submitted to accredited certification/compliance agencies. It ensures
that product compliance outcomes are:

- Deterministic
- Auditable
- Non-bypassable
- Enforced through explicit transitions

No product may be listed, sold, or remain available unless it is in a compliant
state permitted by this workflow.

---

## 2. Non-Negotiable Rules
1) All transitions must be explicit and recorded.  
2) No manual overrides exist outside this state machine.  
3) Any missing or invalid transition is a governance violation.  
4) Compliance approval is independent and cannot be issued by the marketplace.  
5) Expired or suspended compliance immediately removes listing eligibility.

---

## 3. Canonical States (Locked)

| State | Description |
|------|-------------|
| DRAFT | Manufacturer has created a compliance submission but not submitted to an agency. |
| SUBMITTED | Submission sent to an accredited compliance agency. |
| IN_REVIEW | Agency acknowledges review in progress. |
| EVIDENCE_REQUESTED | Agency requires additional documents or clarification. |
| EVIDENCE_SUBMITTED | Manufacturer has supplied requested evidence. |
| CERTIFIED | Agency issues compliance approval/certificate. |
| REJECTED | Agency rejects submission; product is not certifiable. |
| EXPIRED | Certificate has expired or lapsed. |
| SUSPENDED | Compliance status suspended due to regulatory or governance breach. |
| WITHDRAWN | Manufacturer withdraws the submission voluntarily. |

---

## 4. Allowed Transitions (Locked)

| From | To | Trigger | Actor |
|------|----|---------|-------|
| DRAFT | SUBMITTED | Manufacturer submits to agency | Manufacturer |
| SUBMITTED | IN_REVIEW | Agency acknowledges review | Compliance Agency |
| IN_REVIEW | EVIDENCE_REQUESTED | Agency requests additional evidence | Compliance Agency |
| EVIDENCE_REQUESTED | EVIDENCE_SUBMITTED | Manufacturer supplies evidence | Manufacturer |
| EVIDENCE_SUBMITTED | IN_REVIEW | Agency resumes review | Compliance Agency |
| IN_REVIEW | CERTIFIED | Agency issues certificate | Compliance Agency |
| IN_REVIEW | REJECTED | Agency rejects | Compliance Agency |
| CERTIFIED | EXPIRED | Certificate expiry date reached | System |
| CERTIFIED | SUSPENDED | Compliance breach or regulatory suspension | Admin/Regulator |
| SUSPENDED | CERTIFIED | Reinstatement after verified remediation | Admin/Regulator |
| DRAFT | WITHDRAWN | Manufacturer withdraws prior to submission | Manufacturer |
| SUBMITTED | WITHDRAWN | Manufacturer withdraws after submission | Manufacturer |
| EVIDENCE_REQUESTED | WITHDRAWN | Manufacturer withdraws | Manufacturer |
| REJECTED | DRAFT | Manufacturer reopens as new submission version | Manufacturer |

**All other transitions are forbidden.**

---

## 5. Listing Eligibility Rules

| State | Listing Eligible |
|------|------------------|
| CERTIFIED | ✅ Yes |
| DRAFT / SUBMITTED / IN_REVIEW / EVIDENCE_REQUESTED / EVIDENCE_SUBMITTED | ❌ No |
| REJECTED | ❌ No |
| EXPIRED | ❌ No |
| SUSPENDED | ❌ No |
| WITHDRAWN | ❌ No |

---

## 6. Required Evidence & Audit Records
Each transition must append an immutable record containing:

- complianceWorkflowId
- previousState
- nextState
- actorRole + actorId
- timestamp
- evidenceRefs (certificate ID, request ID, or file hash)
- immutable hash of the transition payload

No transition is valid without evidence.

---

## 7. System Behaviours (Hard Guards)
The platform must enforce:

1) No product listing without CERTIFIED state.  
2) Auto-unlist on EXPIRED or SUSPENDED.  
3) Auto-block on REJECTED.  
4) Re-submission requires new workflow version (REJECTED → DRAFT).  
5) Compliance partner controls decision states only (IN_REVIEW → CERTIFIED/REJECTED).

---

## 8. Change Control
This state machine is **LOCKED**.

Any change requires:
- Formal change request
- Version increment
- Governance review and approval
- New lock record

---

## 9. Status
CW-SM-01 is authoritative and binding across:

- Supplier onboarding
- Product listing
- Compliance partner workflows
- Marketplace eligibility enforcement

**Status: LOCKED (v1.0)**
