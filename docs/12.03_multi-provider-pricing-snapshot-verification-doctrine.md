12.03 — Multi-Provider Pricing Snapshot Verification Doctrine
1. Purpose

This doctrine defines how pricing snapshots are verified, enforced, and validated across multiple payment providers to guarantee that no provider can alter commercial terms, intentionally or unintentionally.

The objective is absolute pricing integrity from checkout commitment through settlement, regardless of payment provider.

2. Governing Principle

The pricing snapshot is the single commercial truth.
Payment providers are incapable of redefining it.

No provider may influence price, tax, fees, currency, or settlement logic once a snapshot is locked.

3. Scope

This doctrine applies to:

• All payment providers
• All payment methods
• All checkout flows
• All refunds and disputes
• All environments (dev, staging, production)

Out of scope:

• Internal provider risk scoring
• Provider UI presentation logic

4. Pricing Snapshot Definition

A Pricing Snapshot is an immutable record containing:

• Product prices
• Quantity and units
• Discounts and incentives applied
• Margin floor confirmation
• Freight, duties, GST
• Total payable amount
• Currency
• Timestamp and hash

Once generated, it cannot be modified.

5. Snapshot Lock Moment

The pricing snapshot is locked:

• At buyer checkout confirmation
• Before payment intent creation
• Before any provider interaction

No payment action may precede snapshot lock.

6. Snapshot Hashing & Integrity

Each snapshot must:

• Be cryptographically hashed
• Store the hash immutably
• Be referenced by all downstream systems

The hash becomes the verification anchor for all payments.

7. Provider Payload Construction

When interacting with a provider:

• The payable amount is derived exclusively from the snapshot
• No provider-side calculation is permitted
• Currency conversion (if required) is governed internally

Provider payloads are generated, not negotiated.

8. Provider Event Validation

Every provider event must be validated by:

• Matching provider amount to snapshot total
• Matching currency to snapshot currency
• Matching transaction reference to snapshot ID

Any mismatch triggers immediate rejection.

9. Multi-Provider Consistency Rule

Across all providers:

• The snapshot hash must match exactly
• The payable amount must be identical
• The settlement semantics must be equivalent

Providers may differ in mechanics, not outcomes.

10. Snapshot Drift Detection

The system must detect and block:

• Rounding drift
• Currency precision mismatches
• Fee injection
• Silent provider adjustments

Drift equals invalid payment.

11. Escrow Binding

Escrow records must:

• Reference the pricing snapshot ID
• Reference the snapshot hash
• Reject settlement if mismatch exists

No escrow may exist without a valid snapshot.

12. Refund Verification

Refunds must:

• Reference the original pricing snapshot
• Not exceed authorised refundable amounts
• Be validated before execution

Partial refunds must remain snapshot-consistent.

13. Dispute Snapshot Enforcement

When disputes occur:

• The pricing snapshot is treated as authoritative evidence
• Provider claims are secondary
• Resolution logic references snapshot only

No dispute can alter snapshot truth.

14. Audit & Replay Capability

The system must support:

• Replay of snapshot → payment → escrow events
• Hash verification during audits
• Regulator-readable evidence packs

Snapshots must survive provider deactivation.

15. Provider Failure Handling

If a provider reports a successful payment that fails snapshot verification:

• Funds are not released
• Escrow is not created
• Incident workflow is triggered

Provider success ≠ platform acceptance.

16. Logging & Traceability

Each snapshot verification event must log:

• Snapshot ID
• Snapshot hash
• Provider ID
• Validation outcome
• Timestamp

Logs are immutable.

17. Security & Abuse Resistance

The doctrine must resist:

• Provider-side manipulation
• API replay attacks
• Event reordering
• Duplicate notifications

Verification is deterministic.

18. Change Control

Any change affecting:

• Snapshot structure
• Hashing algorithm
• Validation rules

Requires formal change control and re-approval.

19. Enforcement Status

This doctrine is:

• Mandatory
• Non-optional
• Enforced at runtime

No feature flag may disable it.

20. Status

Status: DRAFT
Phase: 12 — Payments, Escrow & Settlement

Upstream Dependencies:
• 12.01 — Payments, Escrow & Settlement Governance
• 12.02 — Payment Provider Integration Governance

Downstream Dependencies:
• 12.04 — Escrow Lifecycle & Settlement Trigger Rules