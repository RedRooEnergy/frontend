# EXT-GOV-04 Phase 3A - 14-Day Sandbox Telemetry Calendar

## Purpose
Provide fixed execution cadence and evidence checkpoints for Phase 3A activation:
- 48-hour shadow warmup
- 7-day non-strict enforcement pilot
- optional strict-mode pilot after clean non-strict window

## Baseline Signals (authoritative)
Source: `scripts/governance/authority-enforcement-guard.ts` output over shadow metrics snapshot.

Track on every run:
- `report.deterministicHashSha256`
- `guard.overallStatus`
- `guard.signals[CONFLICT_RATE].value`
- `guard.signals[CASE_OPEN_RATE].value`
- `guard.signals[POLICY_VERSION_UNRESOLVED_RATE].value`
- `guard.signals[SHADOW_VS_ENFORCEMENT_DIVERGENCE_RATE].value`
- `guard.signals[DETERMINISTIC_MISMATCH].value`

Rollback trigger:
- Any `PAGE` -> set `GOV04_AUTH_ENFORCEMENT_KILL_SWITCH=true`

## Phase A - Shadow Warmup (48 Hours)
Flags:
```env
ENABLE_GOV04_AUTHORITY_SHADOW=true
ENABLE_GOV04_AUTHORITY_ENFORCEMENT=false
```

Cadence:
- Run guard every 4 hours.

Expected steady state:
- `DETERMINISTIC_MISMATCH == 0`
- `SHADOW_VS_ENFORCEMENT_DIVERGENCE_RATE == 0`
- `POLICY_VERSION_UNRESOLVED_RATE == 0`
- `CONFLICT_RATE < 0.01`
- `CASE_OPEN_RATE < 0.02`

## Phase B - Enforcement Non-Strict (Days 3-9)
Flags:
```env
ENABLE_GOV04_AUTHORITY_ENFORCEMENT=true
GOV04_AUTH_ENFORCEMENT_STRICT_MODE=false
GOV04_AUTH_ENFORCEMENT_KILL_SWITCH=false
```

Cadence:
- First 24h: every 15 minutes.
- Remaining window: every 60 minutes.

Additional checks:
- `PRODUCT_APPROVED` 403 trend (unexpected spikes)
- Fee emission integrity for allowed requests
- No route regression

Expected steady state:
- `SHADOW_VS_ENFORCEMENT_DIVERGENCE_RATE == 0`
- `DETERMINISTIC_MISMATCH == 0`
- no unexplained 403 surge

## Phase C - Strict-Mode Pilot (Optional, Days 10-14)
Entry criteria:
- 7 clean non-strict days with no PAGE and no rollback action.

Flags:
```env
GOV04_AUTH_ENFORCEMENT_STRICT_MODE=true
```

Cadence:
- First 24h: every 15 minutes.
- Remaining window: every 60 minutes.

Expected steady state:
- no internal-fault-induced block bursts
- no divergence
- no deterministic mismatch

## Reporting Cadence
- Every 24h: publish daily telemetry summary.
- End of Day 14: publish sandbox closure report with:
  - total guard runs
  - WARN/PAGE count
  - max divergence rate
  - max conflict rate
  - kill-switch events (if any)
  - go/no-go recommendation

## Automation Recommendation
Use auto-guard as the scheduled job command:
```bash
cd frontend
npx tsx scripts/governance/authority-enforcement-auto-guard.ts \
  --mode local \
  --source cli_local \
  --tenantId <sandbox-tenant-id> \
  --policyId gov04.authority.catalog.product_approval.enforce.v1
```

Expected automation behavior:
- Persists guard report every execution.
- On `PAGE`, appends `KILL_SWITCH_ACTIVATED` control event.
- Exit code `2` for scheduler alerting and incident hooks.
- Appends summary line to `<output-dir>/index.jsonl` for quick grep/trend checks.

Daily digest generator:
```bash
cd frontend
npx tsx scripts/governance/authority-guard-digest.ts \
  --index artefacts/governance/authority-auto-guard/index.jsonl \
  --date 2026-02-14 \
  --out artefacts/governance/authority-auto-guard/digest-2026-02-14.md
```

### Cron Example
Use wrapper script as the single scheduler target:
```cron
# First 24h (manual temporary schedule): every 15 minutes
*/15 * * * * cd /path/to/repo/frontend && \
  GOV04_AUTH_GUARD_TENANT_ID=<sandbox-tenant-id> \
  GOV04_AUTH_GUARD_POLICY_ID=gov04.authority.catalog.product_approval.enforce.v1 \
  scripts/governance/run-authority-enforcement-auto-guard.sh
```

### systemd Timer Example
Service `authority-auto-guard.service` should execute:
```bash
/path/to/repo/frontend/scripts/governance/run-authority-enforcement-auto-guard.sh
```
Timer frequency should follow the phase cadence:
- first 24h: 15 minutes
- days 2-7: 60 minutes
- days 8-14: 4 hours

### GitHub Actions (workflow_dispatch/schedule) Example
Use a self-hosted runner with Mongo/network access and run:
```bash
cd frontend
GOV04_AUTH_GUARD_TENANT_ID=<sandbox-tenant-id> \
GOV04_AUTH_GUARD_POLICY_ID=gov04.authority.catalog.product_approval.enforce.v1 \
scripts/governance/run-authority-enforcement-auto-guard.sh
```
