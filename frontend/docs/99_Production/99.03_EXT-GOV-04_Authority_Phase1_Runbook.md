# EXT-GOV-04 Phase 1 Runbook (Authority Plane Observe Mode)

## Scope
Phase 1 enables append-only, deterministic authority telemetry in observe mode only.

Included artefacts:
- `governance_authority_policy_versions`
- `governance_authority_policy_lifecycle_events`
- `governance_authority_delegation_events`
- `governance_authority_approval_decisions`
- Authority export evidence pack (`gov04-authority-export.v1`)

Excluded in Phase 1:
- No authorization enforcement
- No request blocking
- No privileged elevation gating
- No identity or compliance-plane enforcement

## Feature Flags
- `ENABLE_GOV04_AUTHORITY_OBSERVE` (default `false`)
- `GOV04_AUTHORITY_EXPORT_JOB_SECRET` (required only for signed export route)
- `GOV04_AUTHORITY_OBSERVE_POLICY_ID` (optional, defaults to `gov04-authority-observe-default`)
- `GOV04_AUTHORITY_OBSERVE_POLICY_VERSION_HASH` (optional SHA-256; if unset, service registers deterministic fallback policy)

## Deterministic Controls
Authority artefacts use deterministic IDs and idempotency keys:
- Artifact ID: `sha256(lengthPrefixedEncode([artifactClass, tenantId, primaryKeys..., canonicalPayloadHash]))`
- Idempotency key: `sha256(lengthPrefixedEncode(["idempotency", artifactClass, tenantId, primaryKeys..., canonicalPayloadHash]))`

No UUID/random IDs are used for authority artefacts.

Actor provenance is deterministic:
- Actor chain fields are normalized and SHA-256 hashed (`actorChainHashSha256`)
- Decision payloads reference `policyId` + `policyVersionHash`

## Observe-Mode Failure Behavior
Authority observe logging is fail-open:
- If observe write fails, caller flow continues
- No retries are performed inline
- No mutation blocking is introduced
- Failure is logged as `gov04_authority_observe_failed`

## Signed Export Route
Route:
- `POST /api/internal/governance/authority/export`

Security controls:
- Route disabled when `ENABLE_GOV04_AUTHORITY_OBSERVE=false`
- HMAC SHA-256 signature required (`x-rre-job-signature`)
- Timestamp required (`x-rre-job-timestamp`)
- Signature tolerance: Â±300 seconds

Response:
- Deterministic report with hash chain and `exportRootHash`
- Signature bundle uses `INTERNAL_UNSIGNED_V1` for Phase 1

## CLI
Use:
- `tsx scripts/governance/authority-export.ts --mode local --from <iso> --to <iso>`
- `tsx scripts/governance/authority-export.ts --mode http --url <route> --secret <secret>`

## Operational Validation
1. Keep `ENABLE_GOV04_AUTHORITY_OBSERVE=false` in production baseline.
2. Enable in sandbox and confirm non-blocking behavior.
3. Execute two identical exports over same window and verify:
- identical `deterministicHashSha256`
- identical `exportRootHash`
4. Verify no payment/freight state transitions changed when observe mode is enabled.

## Rollback
Immediate rollback path:
- Set `ENABLE_GOV04_AUTHORITY_OBSERVE=false`

Effects:
- Stops new authority observe artefacts and export route availability
- Existing append-only records remain for replay and audit
- No destructive migration needed
